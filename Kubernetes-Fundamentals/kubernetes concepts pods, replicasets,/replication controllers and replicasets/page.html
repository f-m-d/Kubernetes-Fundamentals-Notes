<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Replication Controllers and ReplicaSets</title>
</head><body><b><div style="text-align: center"><span style="font-size: 31pt"><span style="color: #0000ff">Replication Controllers and ReplicaSets</span></span></div></b><br/>
<br/>
<br/>
<br/>
I Controllers sono il cervello di Kubernetes.<br/>
Se vuoi darti una ripassata, ripassa su "<b>Kubernetes Overview - Kubernetes Overview</b>".<br/>
<br/>
<br/>
I <b>Controller</b>, in breve, <i>monitorano gli oggetti di Kubernetes e rispondono in modo adeguato</i>.<br/>
<br/>
In questo caso, studiamo un tipo di controllo particolare: il <b>Replication Controller</b>.<br/>
<br/>
<br/>
<br/>
<br/>
<b>Perché abbiamo bisogno dei Controller?</b><br/>
Supponiamo di avere il nostro caso vecchio:<br/>
singolo nodo, singolo POD, singolo container.<br/>
<img src="1.png" /><br/>
<br/>
<br/>
Se l'applicazione crasha, il container faila e il POD crasha.<br/>
Se succede, l'utente potrebbe non avere accesso all'applicazione!<br/>
<img src="1 2.png" /><br/>
<br/>
Per far si che l'applicazione possa continuare a runnare<br/>
e l'utente possa continuare le sue operazioni,<br/>
<b>possono essere creati altri PODs</b>&nbsp;(su stesso nodo o altri nodi).<br/>
Il <b>Replication Controller</b>&nbsp;è il <b>Controller</b>&nbsp;che si occupa di questo caso!<br/>
<img src="1 3.png" /><br/>
<br/>
Da notare bene: Puoi usare il Replication Controller<br/>
anche se hai bisogno di un solo POD per nodo.<br/>
Inoltre, tiene sotto controllo i POD e il loro stato.<br/>
<br/>
<br/>
<br/>
Un buon motivo per usare il Replication Controller<br/>
è per il <b>Load Balancing</b>&nbsp;e <b>Scaling</b>.<br/>
<img src="1 4.png" /><br/>
<br/>
<hr/><hr/><br/>
<div style="text-align: center"><span style="font-size: 31pt"><span style="color: #0000ff"><b>Replication Controller vs Replica Set</b></span></span></div><br/>
<br/>
<br/>
Replication Controller vs Replica Set.<br/>
Anche se hanno lo stesso scopo, non sono lo stesso elemento.<br/>
<br/>
<br/>
Replication Controller è la <i>vecchia tecnologia</i>&nbsp;rimpiazzata da Replica Set.<br/>
<b>Replica Set è il nuovo modo consigliato per settare le applicazioni.</b><br/>
Hanno piccole differenze, ma hanno lo stesso scopo.<br/>
<hr/><hr/><br/>
<br/>
<div style="text-align: center"><span style="font-size: 31pt"><span style="color: #0000ff"><b>Come creare un Replica Set</b></span></span></div><br/>
<br/>
<br/>
Bisogna specificare il tipo in kind, mentre per la sezione spec:<br/>
dobbiamo specificare il template di POD da replicare. <br/>
<img src="1 5.png" /><br/>
<br/>
<br/>
Per la sezione POD di spec: ci basta usare le linee importanti,<br/>
come i metadata e le spec del POD.<br/>
Le apiVersion le abbiamo già definite e non dobbiamo specifiare all'interno che è un POD.<br/>
<img src="1 6.png" /><br/>
<br/>
<br/>
<br/>
Ora ci rimane da dire: quante repliche fare?<br/>
Basta settare un parametro, figlio di spec "replicas".<br/>
<img src="1 7.png" /><br/>
<br/>
<hr/><hr/><br/>
<br/>
Ora diamo uno sguardo a ReplicaSets.<br/>
<br/>
Ecco alcune differenze rispetto al ReplicationController:<br/>
L'API è "apps/v1", necessita di app prima.<ul><li style="list-style-type: none">NB: nel caso sbagli sopra, ti darà un errore simile:</li>
<li style="list-style-type: none"><img src="1 8.png" /></li>
<li style="list-style-type: none"></li>
<li style="list-style-type: none"></li>
</ul>
Un parametro "selector": indica quale parte è del ReplicaSet.<br/>
Questo perché possiamo gestire parti non create dal ReplicaSet, al momento della creazione.<br/>
<br/>
<b>Esempio:</b>&nbsp;Quando vi sono PODs creati prima della creazione del ReplicaSets.,<br/>
che matchano le lables presenti nel selectors.<br/>
In questo modo, il<b>&nbsp;ReplicaSets prenderà in considerazione anche queste parti</b><br/>
quando crea le replica.<br/>
<br/>
Infatti, il <b>"selector" è una delle differenze sostanziali</b>&nbsp;tra Replication Controller e ReplicaSets.<br/>
"selector" non è richiesto per il Replication Controller, anche se puoi metterlo!<br/>
<b>Questo perché il Replication Controller assume che sia la stessa label del POD definito.<br/>
</b><img src="1 9.png" /><br/>
<br/>
<br/>
<hr/><hr/><br/>
<b><span style="color: #0000ff"><div style="text-align: center"><span style="font-size: 31pt">Perché usiamo i Labels e Selectors?</span></div></span></b><br/>
<br/>
<br/>
<b>Esempio: </b>supponiamo che abbiamo deployato la nostra applicazione con 3 PODs.<br/>
Vogliamo creare un ReplicationController/ReplicaSets per far si che<br/>
questi 3 PODs siano sempre attivi in ogni momento. <br/>
<br/>
Questo è proprio il caso per usare i ReplicaSets.<br/>
Puoi usarli per monitorare parti esistenti.<br/>
Quando crei i ReplicaSets, crea i 3 PODs nel caso non esistano già.<br/>
<br/>
Il ruolo dei ReplicaSets è di monitorare i PODs e di deployarne<br/>
di nuovi quando questi failano.<br/>
<br/>
<b>Ora:</b>&nbsp;come fa il ReplicaSets a sapere quali parti monitorare?<br/>
Tramite i <b>Labels</b>.<br/>
<img src="1 10.png" /><br/>
<br/>
<img src="1 11.png" width="900" height="476" /><br/>
<br/>
<br/>
<br/>
Altra domanda: come facciamo a scalare nel caso di più utenti?<br/>
<br/>
Esistono diversi modi:<br/>
<br/>
1) Cambi il numero di "replicas" (e.g. da 3 a 6) ed usi "<b>kubectl replace -f</b>" <br/>
<img src="1 12.png" width="900" height="529" /><br/>
<br/>
<br/>
2) Possiamo usare "kubectl scale --replicas" per scalare il numero di replicas, passando il file di configurazione.<br/>
NB: Questo scala gli elementi, ma non cambia il numero di replicas nel file config yaml!<br/>
<img src="1 14.png" /><br/>
<br/>
<br/>
Esistono altre opzioni per scalare in base al Load Balance, ma verrà discusso in sezioni successive.<br/>
<br/>
<hr/><hr/><br/>
<br/>
Comandi utili:<br/>
<img src="1 13.png" /><br/>
</body></html>